jQuery(document).ready(function(jQuery){var usedPlugins=[];var cdnjsSelected=jQuery('#cdnjs-selected');var cdnjsScripts=jQuery('#cdnjs_settings_scripts');cdnjsSelected.find('.index').each(function(){usedPlugins.push(jQuery(this).find('input.plugin_name').val());});function remoteAjaxAutoComplete(element,url){jQuery(element).select2({width:"55%",id:'name',multiple:false,placeholder:cdnjs_text.search_placeholder,minimumInputLength:2,ajax:{url:url,dataType:'json',data:function(term,page){return{search:term,page_limit:20}},results:function(data,page){if(usedPlugins){for(var j=0;j<data.results.length;j++){for(var i=0;i<usedPlugins.length;i++){if(usedPlugins[i]===data.results[j].name){data.results[j].disabled=true;break;}else{data.results[j].disabled=false;}}}}
return data;}},formatResult:formatLibraryResults,formatSelection:formatLibrarySelection});}
function formatLibraryResults(data){return'<div id="opt-'+data.filename+'" class="cdnjs-selection" title="'+data.description+'">'+data.name+' '+data.version+' ( '+data.assets.length+' versions) '+data.description+'</div>';}
function formatLibrarySelection(data,container){usedPlugins.push(data.name);return data.name;}
remoteAjaxAutoComplete('#cdnjs_settings_scripts','//api.cdnjs.com/libraries?fields=version,filename,description,assets');cdnjsScripts.on('select2-selecting',function(e,data){if(!e.object){e.object=data;}
jQuery('.cdnjs-selected label, .cdnjs-selected #cdnjs-selected').show();addLibraryRow(e.object,'#cdnjs-selected tbody');});cdnjsScripts.on('select2-close',function(e,data){cdnjsScripts.select2('data',null);});onVersionChange();onAssetChange();cdnjsSelected.find('tbody').sortable({cursor:"move",handle:"i.fa-arrows-v",stop:function(event,ui){cdnjsSelected.find('tr').removeClass('alternate');cdnjsSelected.find('tr:odd').addClass('alternate');}});cdnjsSelected.find('tr:odd').addClass('alternate');jQuery('.wp-cdnjs-remove-row').live('click',function(e){var el=jQuery(this).parent().parent();var name=el.find('input.plugin_name').val();el.remove();for(var i=usedPlugins.length-1;i>=0;i--){if(usedPlugins[i]===name){usedPlugins.splice(i,1);}}});});function onAssetChange(){jQuery('.select2-assets').not('.select2-offscreen').each(function(i,obj){var objID=jQuery('#'+obj.id);objID.select2({width:"100%",placeholder:cdnjs_text.add_assets,formatNoMatches:function(){return cdnjs_text.no_addl_assets;},ajax:{url:'//api.cdnjs.com/libraries?fields=assets',dataType:'json',data:function(term,page){return{search:jQuery(this).data("plugin-name")};},results:function(data,page){var results=[];var used_assets=[];assetId=cleanName(data.results[0].name);selectedVersion=jQuery('#'+assetId+'-row .wp-cdnjs_name input.plugin_version').val();theMainAsset=objID.data("asset-id");jQuery('#'+assetId+'-asset-holder input').each(function(){used_assets.push(jQuery(this).val());});for(j=0;j<data.results[0].assets.length;j++){asset=data.results[0].assets[j];if(selectedVersion==asset.version){for(i=0;i<asset.files.length;i++){assetToCheck=(!jQuery('#cdnjs_settings_avoid_minified').prop("checked"))?asset.files[i]:asset.files[i].replace('.min','');if(jQuery.inArray(assetToCheck,used_assets)==-1){if(getFileExtension(assetToCheck)){results.push({id:asset.files[i],text:asset.files[i]});}}}}}
return{results:results};}}});objID.on('select2-selecting',function(e,data){if(!e.object){e.object=data;}
addAssetRow(e.object,objID.data("plugin-name"));});objID.on('select2-close',function(e,data){objID.select2('data',null);});});}
function onVersionChange(){jQuery('.select2-version').not('.select2-offscreen').each(function(i,obj){var objID=jQuery('#'+obj.id);var pluginId=objID.data("plugin-id");var currentVersion=jQuery('#'+pluginId+'-row input.plugin_version').val();objID.select2({width:"100%",placeholder:cdnjs_text.choose_version,formatNoMatches:function(){return cdnjs_text.no_addl_version;},ajax:{url:'//api.cdnjs.com/libraries?fields=assets',dataType:'json',data:function(term,page){return{search:jQuery(this).data("plugin-name")};},results:function(data,page){var results=[];currentVersion=jQuery('#'+pluginId+'-row input.plugin_version').val();var assets=data.results[0].assets;for(i=0;i<assets.length;i++){if(currentVersion==assets[i].version){results.push({id:assets[i].version,text:assets[i].version,disabled:true});}else{results.push({id:assets[i].version,text:assets[i].version,disabled:false});}}
return{results:results};}},formatSelection:formatVersionSelection});function formatVersionSelection(data,container){currentVersion=data.version;return data.version;}
objID.on('select2-selecting',function(e,data){if(!e.object){e.object=data;}
changeVersion(objID.data("plugin-name"),e.object.text);});objID.on('select2-close',function(e,data){objID.select2('data',null);});});}
function getFileExtension(filename){return!!(filename.split('.').pop()=='css'||filename.split('.').pop()=='js');}
function cleanName(str){return str.replace(/[^a-zA-Z\d ]/g,'-').toLowerCase();}
function addLibraryRow(data,location){var assets=data.assets[0].files;var default_asset=data.filename;var nameID=cleanName(data.name);if(!jQuery('#cdnjs_settings_avoid_minified').prop("checked")){if(default_asset.indexOf('.min.')==-1){for(i=0;i<assets.length;i++){var tmp=assets[i];if(default_asset==tmp.replace('.min','')){default_asset=assets[i];}}}}else{if(default_asset.indexOf('.min.')>-1){for(i=0;i<assets.length;i++){var tmp=assets[i];if(tmp==default_asset.replace('.min','')){default_asset=tmp;}}}}
var row='<tr id="'+nameID+'-row" class="index">';row+='<td class="wp-cdnjs_move"><i class="fa fa-arrows-v"></i></td>';row+='<td class="wp-cdnjs_name"><strong>'+data.name+'</strong> <br/>'+cdnjs_text.version+': <span class="currentVersion">'+data.version+'</span>';row+='<input type="hidden" name="cdnjs[cdnjs_settings_scripts]['+nameID+'][name]" class="plugin_name" value="'+data.name+'"/>';row+='<input type="hidden" name="cdnjs[cdnjs_settings_scripts]['+nameID+'][version]" class="plugin_version" value="'+data.version+'"/>';row+='</td>';row+='<td class="wp-cdnjs_choose_version"><input type="hidden" id="'+nameID+'-choose_version" data-plugin-id="'+nameID+'" data-plugin-name="'+data.name+'" data-version="'+data.version+'" class="select2-version"></td>';row+='<td class="wp-cdnjs_assets">';row+='<div id="'+nameID+'-asset-holder" class="included_assets">';row+='<div id="'+cleanName(default_asset)+'-asset-row"><strong>'+default_asset+'</strong>';row+=' <i title="'+cdnjs_text.remove+'" style="cursor:pointer" class="fa fa-times" onclick="removeRow(\'#'+cleanName(default_asset)+'-asset-row\');"></i><br />';row+='<input type="hidden" name="cdnjs[cdnjs_settings_scripts]['+nameID+'][assets][]" value="'+default_asset+'">';row+='</div>';row+='</div>';row+='</td>';row+='<td class="wp-cdnjs_add_assets"><input type="hidden" id="'+nameID+'-add_assets" data-plugin-name="'+data.name+'" data-asset-id="'+cleanName(default_asset)+'" data-asset-file="'+default_asset+'" class="select2-assets"></td>';row+='<td class="wp-cdnjs_location"><select name="cdnjs[cdnjs_settings_scripts]['+nameID+'][location]" id=""><option value="1" selected="selected">'+cdnjs_text.footer+'</option><option value="0">'+cdnjs_text.header+'</option></select></td>';row+='<td class="wp-cdnjs_enable"><input type="hidden" name="cdnjs[cdnjs_settings_scripts]['+nameID+'][enabled]" id="" value="0"><input type="checkbox" name="cdnjs[cdnjs_settings_scripts]['+nameID+'][enabled]" id="" value="1" checked="checked"></td>';row+='<td><span class="wp-cdnjs-remove-row button-secondary">'+cdnjs_text.remove+'</span></td>';row+='</tr>';jQuery(location).append(row);jQuery('#cdnjs-selected tr:odd').addClass('alternate');onVersionChange();onAssetChange();}
function addAssetRow(data,location){var parentId=cleanName(location);var assetId=cleanName(data.text);var row='<div id="'+assetId+'-asset-row">';row+=data.text;row+=' <i title="'+cdnjs_text.remove+'" style="cursor:pointer" class="fa fa-times" onclick="removeRow(\'#'+assetId+'-asset-row\');"></i><br />';row+='<input type="hidden" name="cdnjs[cdnjs_settings_scripts]['+parentId+'][assets][]" value="'+data.text+'"/>';row+='</div>';jQuery('#'+parentId+'-row div.included_assets').append(row);}
function changeVersion(location,newVersion){var parentId=cleanName(location);jQuery('#'+parentId+'-row span.currentVersion').text(newVersion);jQuery('#'+parentId+'-row input.plugin_version').val(newVersion);jQuery('#'+parentId+'-choose_version').data('version',newVersion);jQuery('#'+parentId+'-choose_version').val(newVersion);}
function removeRow(row_id){if(jQuery(row_id).parent().children().size()>1){jQuery(row_id).remove();}else{jQuery('h1').after('<div id="setting-error-settings_updated" class="updated settings-error notice error is-dismissible">\
    <p><strong>'+cdnjs_text.cannot_remove+'</strong></p>\
    <button type="button" class="notice-dismiss" onClick="div=this.parentElement;div.parentElement.removeChild(div);">\
      <span class="screen-reader-text">'+cdnjs_text.dismiss+'</span>\
    </button></div>');}}